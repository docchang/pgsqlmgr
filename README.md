# PostgreSQL Manager (pgsqlmgr)

A modern CLI tool for managing PostgreSQL instances across local and remote environments with seamless database synchronization capabilities.

## üéØ Overview

PostgreSQL Manager (`pgsqlmgr`) is a Python-based command-line tool designed to simplify PostgreSQL database management across multiple environments. Whether you're working with local installations or remote servers via SSH, this tool provides a unified interface for common database operations.

## ‚ú® Features

### ‚úÖ Implemented Features (Current)
- üîß **Installation Management**: Check and install PostgreSQL on local and remote (SSH) hosts
- üîÑ **Database Synchronization**: Seamless sync between local and SSH instances using `pg_dump`/`pg_restore`
- üóëÔ∏è **Database Deletion**: Safe database deletion with confirmation prompts and backup options
- ‚öôÔ∏è **Configuration Management**: Unified YAML configuration with inheritance-based host types
- üìä **Database Listing**: List all databases with sizes, owners, and access privileges
- üìã **Table Listing**: List tables across databases with schema, size, and row count information
- üîç **Table Content Preview**: View actual table data (10 records per table, integrated with table listing)
- üë• **User Management**: List PostgreSQL users/roles with detailed permission information
- üé® **Rich CLI Interface**: Beautiful command-line interface with colored tables and progress indicators
- üîê **Secure Authentication**: PostgreSQL standard `.pgpass` authentication with helpful error guidance
- üèóÔ∏è **Type-Safe Configuration**: Enum-based host types with inheritance for maintainability
- ‚úÖ **Configuration Validation**: Comprehensive config file validation with detailed error reporting

### Phase 2 (v2.0) - Future Enhancements
- ‚òÅÔ∏è **Cloud Integration**: Support for Supabase, AWS RDS, and other cloud providers
- üöÄ **Advanced Sync Options**: Incremental sync, schema-only sync, and more
- üìä **Monitoring Dashboard**: Optional web interface for database monitoring
- üîê **Advanced Security**: `.pgpass` file generation helper and SSH key management

## üèóÔ∏è Project Status

**Current Status**: üöÄ **Active Development - Core Features Complete**

The project has implemented all core database management functionality including listing, synchronization, and deletion with comprehensive testing coverage (127 tests passing). The foundation is solid with modern Python packaging standards, secure authentication, and robust error handling.

**Recent Additions**:
- ‚úÖ **Authentication & Configuration Cleanup**: Removed password fields, implemented `.pgpass` authentication with helpful error guidance
- ‚úÖ **Database Deletion Functionality**: Safe deletion with confirmation prompts and backup options
- ‚úÖ Complete listing functionality (databases, tables, users)
- ‚úÖ Table content preview with intelligent column styling
- ‚úÖ Simple preview option (--preview for 10 records)
- ‚úÖ Rich table displays with color coding
- ‚úÖ Inheritance-based configuration system
- ‚úÖ Type-safe enum system for host types
- ‚úÖ Comprehensive test suite (127 tests passing)

## üöÄ Installation

### End Users (when v1.0 is released)
```bash
pip install pgsql-manager
pgsqlmgr --help
```

### Developers

#### Standard Setup
```bash
git clone https://github.com/docchang/pgsqlmgr.git
cd pgsqlmgr
python -m venv .venv
source .venv/bin/activate  # On Windows: .venv\Scripts\activate
pip install -e . --use-pep517
pgsqlmgr --help
```

#### Apple Silicon (M1/M2/M3) Setup
If you encounter cryptography/hashlib errors on Apple Silicon:

**Quick Setup (Recommended)**:
```bash
git clone https://github.com/docchang/pgsqlmgr.git
cd pgsqlmgr
chmod +x setup_arm64.sh
./setup_arm64.sh
```

**Manual Setup**:
```bash
git clone https://github.com/docchang/pgsqlmgr.git
cd pgsqlmgr
source simple-fix/setup_arm64_homebrew.sh
create_arm64_venv .venv
source .venv/bin/activate
pip install -e .
pgsqlmgr --help
```

## üöÄ Quick Start

1. **Install the package** (developers):
   ```bash
   git clone https://github.com/docchang/pgsqlmgr.git
   cd pgsqlmgr
   python -m venv .venv && source .venv/bin/activate
   pip install -e .
   ```

2. **Set up SSH config** (for remote hosts):
   ```bash
   # Add entries to ~/.ssh/config
   Host production
       HostName your-server.com
       User your-username
       IdentityFile ~/.ssh/id_rsa
   ```

3. **Initialize configuration**:
   ```bash
   pgsqlmgr init-config
   ```

4. **List your hosts**:
   ```bash
   pgsqlmgr list-hosts
   ```

5. **Explore your databases**:
   ```bash
   pgsqlmgr list-databases localhost
   pgsqlmgr list-tables localhost --database myapp_db
   pgsqlmgr list-users localhost
   ```

## üíª Usage

### Prerequisites

**SSH Configuration**: Before using SSH features, configure your `~/.ssh/config` file:

```bash
# ~/.ssh/config
Host production
    HostName production.example.com
    User admin
    IdentityFile ~/.ssh/id_rsa

Host staging
    HostName staging.example.com
    User deploy
    IdentityFile ~/.ssh/id_rsa
```

**PostgreSQL Authentication**: Set up PostgreSQL authentication using the standard `.pgpass` file:

```bash
# ~/.pgpass format: hostname:port:database:username:password
# Only superuser passwords needed - connection details are in ~/.ssh/config

# Local PostgreSQL
localhost:5432:*:postgres:your_local_password

# Remote connections via SSH tunnels (use localhost after tunnel)
localhost:5433:*:postgres:production_password
localhost:5434:*:postgres:staging_password
```

**Important**: Set secure permissions: `chmod 600 ~/.pgpass`

### Configuration

Initialize your configuration:
```bash
pgsqlmgr init-config
```

Or manually create `~/.pgsqlmgr/config.yaml`:

```yaml
hosts:
  local:
    type: local
    host: localhost
    port: 5432
    superuser: postgres
    description: Local PostgreSQL instance

  production:
    type: ssh
    ssh_config: production  # References ~/.ssh/config entry
    host: localhost
    port: 5432
    superuser: postgres
    description: Production server via SSH

  staging:
    type: ssh
    ssh_config: staging  # References ~/.ssh/config entry
    host: localhost
    port: 5432
    superuser: admin
    description: Staging server via SSH


  cloud_db:
    type: cloud
    host: db.example.com
    port: 5432
    superuser: admin
    description: Cloud PostgreSQL instance
```

**Note**: 
- Database connection passwords are managed through `~/.pgpass` file, not in the configuration. See Prerequisites section for setup instructions.
- For SSH hosts, during installation the configured `superuser` is created without password (using trusted authentication).

### Available Commands

#### Core Management Commands
```bash
# Show help and available commands
pgsqlmgr --help

# Show version information
pgsqlmgr --version

# Initialize sample configuration file
pgsqlmgr init-config

# List all configured hosts with connection details
pgsqlmgr list-hosts

# List hosts with detailed OS and PostgreSQL installation status
pgsqlmgr list-hosts --detailed

# Show detailed configuration for a specific host
pgsqlmgr show-config <host_name>
pgsqlmgr show-config production

# Validate configuration file
pgsqlmgr validate-config
```

#### Database Listing Commands
```bash
# List user databases (excludes system databases)
pgsqlmgr list-databases localhost

# List all databases including system databases
pgsqlmgr list-databases localhost --include-system

# List tables in a specific database
pgsqlmgr list-tables localhost --database myapp_db

# List tables with content preview (10 records per table)
pgsqlmgr list-tables localhost --database myapp_db --preview

# List tables across all user databases with preview
pgsqlmgr list-tables localhost --preview

# List tables including system tables
pgsqlmgr list-tables localhost --include-system

# Preview specific table content (standalone command, 10 records)
pgsqlmgr preview-table localhost myapp_db users

# List PostgreSQL users and their permissions
pgsqlmgr list-users localhost
```

#### Installation & Service Commands
```bash
# Check PostgreSQL installation status
pgsqlmgr check-install production

# Install PostgreSQL on a host
pgsqlmgr install production

# Update PostgreSQL to the latest version
pgsqlmgr update production

# Update with database backup before upgrading
pgsqlmgr update production --backup-data

# Force update without confirmation (for automation)
pgsqlmgr update production --force

# Uninstall PostgreSQL from a host (with confirmation)
pgsqlmgr uninstall production

# Uninstall with database backup before removal
pgsqlmgr uninstall production --backup-data

# Force uninstall without confirmation (for automation)
pgsqlmgr uninstall production --force

# Start PostgreSQL service
pgsqlmgr start-service production
```

#### Database Synchronization Commands
```bash
# Sync database between hosts
pgsqlmgr sync-db source_host database_name destination_host

# Sync with options
pgsqlmgr sync-db local myapp_db production --drop-existing --auto-install

# Schema-only sync
pgsqlmgr sync-db local myapp_db staging --schema-only

# Data-only sync
pgsqlmgr sync-db local myapp_db staging --data-only
```

#### Database Deletion Commands
```bash
# Delete database with confirmation prompt
pgsqlmgr delete-db localhost old_database

# Delete database with backup before deletion
pgsqlmgr delete-db localhost old_database --backup

# Delete database with custom backup location
pgsqlmgr delete-db localhost old_database --backup --backup-path /backups/

# Force delete without confirmation (for automation)
pgsqlmgr delete-db localhost old_database --force

# Delete database on SSH host with backup
pgsqlmgr delete-db production old_database --backup
```

#### Command Options
Most commands support these global options:
```bash
# Use custom configuration file location
pgsqlmgr --config /path/to/config.yaml list-hosts

# Get help for specific commands
pgsqlmgr show-config --help
pgsqlmgr list-databases --help
```

#### Example Output

**List Databases:**
```bash
$ pgsqlmgr list-databases localhost
üìä Listing databases on localhost...
                           Databases on localhost                            
‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
‚îÉ Database Name ‚îÉ Owner     ‚îÉ Encoding  ‚îÉ Size    ‚îÉ Access Privileges ‚îÉ
‚î°‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î©
‚îÇ myapp_db      ‚îÇ postgres  ‚îÇ UTF8      ‚îÇ 15 MB   ‚îÇ None              ‚îÇ
‚îÇ analytics     ‚îÇ postgres  ‚îÇ UTF8      ‚îÇ 128 MB  ‚îÇ None              ‚îÇ
‚îÇ staging_db    ‚îÇ admin     ‚îÇ UTF8      ‚îÇ 5 MB    ‚îÇ None              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**List Tables:**
```bash
$ pgsqlmgr list-tables localhost --database myapp_db
üìã Listing tables in database 'myapp_db' on localhost...
                    Tables in database 'myapp_db' on localhost                     
‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
‚îÉ Schema  ‚îÉ Table Name   ‚îÉ Owner     ‚îÉ Size     ‚îÉ Est. Rows ‚îÉ
‚î°‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î©
‚îÇ public  ‚îÇ users        ‚îÇ postgres  ‚îÇ 1024 kB  ‚îÇ 1500      ‚îÇ
‚îÇ public  ‚îÇ orders       ‚îÇ postgres  ‚îÇ 2048 kB  ‚îÇ 3200      ‚îÇ
‚îÇ public  ‚îÇ products     ‚îÇ postgres  ‚îÇ 512 kB   ‚îÇ 450       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**List Users:**
```bash
$ pgsqlmgr list-users localhost
üë• Listing users on localhost...
                          PostgreSQL Users on localhost                           
‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
‚îÉ Username   ‚îÉ Superuser  ‚îÉ Create Roles ‚îÉ Create DBs ‚îÉ Can Login ‚îÉ Connection Limit  ‚îÉ Valid Until ‚îÉ
‚î°‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î©
‚îÇ postgres   ‚îÇ ‚úì          ‚îÇ ‚úì            ‚îÇ ‚úì          ‚îÇ ‚úì         ‚îÇ Unlimited         ‚îÇ Never       ‚îÇ
‚îÇ app_user   ‚îÇ ‚úó          ‚îÇ ‚úó            ‚îÇ ‚úó          ‚îÇ ‚úì         ‚îÇ 10                ‚îÇ Never       ‚îÇ
‚îÇ readonly   ‚îÇ ‚úó          ‚îÇ ‚úó            ‚îÇ ‚úó          ‚îÇ ‚úì         ‚îÇ 5                 ‚îÇ Never       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Database Deletion:**
```bash
$ pgsqlmgr delete-db localhost old_database --backup
üóëÔ∏è  Database Deletion Request
   Host: localhost
   Database: old_database
üîç Gathering database information...

üìä Database Information:
Name                old_database
Owner               postgres
Size                25 MB
Encoding            UTF8
Active Connections  0

üíæ Creating backup before deletion...
‚úÖ Backup created: old_database_backup_20241220_143022.sql

‚ö†Ô∏è  WARNING: This will permanently delete database 'old_database' from host 'localhost'!
üíæ Backup saved to: old_database_backup_20241220_143022.sql
This action cannot be undone!

Are you sure you want to delete database 'old_database'? [y/N]: y

üóëÔ∏è  Deleting database 'old_database'...
‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Deletion Complete ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ ‚úÖ Database 'old_database' deleted successfully!                                                         ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
üíæ Backup available at: old_database_backup_20241220_143022.sql
```

**List Hosts:**
```bash
$ pgsqlmgr list-hosts
                                            Configured Hosts                                             
‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
‚îÉ Host Name  ‚îÉ Type  ‚îÉ Connection                      ‚îÉ Description                                    ‚îÉ
‚î°‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î©
‚îÇ local      ‚îÇ local ‚îÇ localhost:5432                  ‚îÇ Local PostgreSQL instance                      ‚îÇ
‚îÇ production ‚îÇ ssh   ‚îÇ ssh production ‚Üí localhost:5432 ‚îÇ Production server via SSH (uses ~/.ssh/config) ‚îÇ
‚îÇ staging    ‚îÇ ssh   ‚îÇ ssh staging ‚Üí localhost:5432    ‚îÇ Staging server via SSH (uses ~/.ssh/config)    ‚îÇ
‚îÇ cloud_db   ‚îÇ cloud ‚îÇ db.example.com:5432             ‚îÇ Cloud PostgreSQL instance                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

$ pgsqlmgr list-hosts --detailed
                                     Configured Hosts (Detailed)                                      
‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
‚îÉ Host Name  ‚îÉ Type  ‚îÉ Connection                      ‚îÉ OS Info          ‚îÉ PostgreSQL       ‚îÉ Description                                    ‚îÉ
‚î°‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î©
‚îÇ local      ‚îÇ local ‚îÇ localhost:5432                  ‚îÇ Darwin 24.5.0    ‚îÇ ‚úÖ v15           ‚îÇ Local PostgreSQL instance                      ‚îÇ
‚îÇ production ‚îÇ ssh   ‚îÇ ssh production ‚Üí localhost:5432 ‚îÇ Ubuntu 24.04     ‚îÇ ‚úÖ v16           ‚îÇ Production server via SSH (uses ~/.ssh/config) ‚îÇ
‚îÇ staging    ‚îÇ ssh   ‚îÇ ssh staging ‚Üí localhost:5432    ‚îÇ Ubuntu 22.04     ‚îÇ ‚ùå Not installed ‚îÇ Staging server via SSH (uses ~/.ssh/config)    ‚îÇ
‚îÇ cloud_db   ‚îÇ cloud ‚îÇ db.example.com:5432             ‚îÇ Cloud            ‚îÇ ‚úÖ v17           ‚îÇ Cloud PostgreSQL instance                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Authentication Setup
The tool uses PostgreSQL's standard `.pgpass` file for authentication. When you run `pgsqlmgr init-config`, you'll receive detailed instructions on setting up your `.pgpass` file with the correct format and permissions.

**Quick Setup Options:**
1. **Automated setup**: Run `./scripts/setup-pgpass.sh` to create a template `.pgpass` file with proper permissions
2. **Manual setup**: Copy `.pgpass.example` to `~/.pgpass` and customize it for your connections
3. **From scratch**: Create `~/.pgpass` manually using the format shown in Prerequisites section

**Development Convenience**: The project includes a symlink `.pgpass` ‚Üí `~/.pgpass` for easy editing within your IDE while keeping the actual file in the standard location.

#### Future Commands (Coming Soon)
```bash
# Generate .pgpass file entries
pgsqlmgr generate-pgpass
```

## üõ†Ô∏è Requirements

- **Python**: 3.10 or higher
- **Local PostgreSQL**: For local database operations
- **PostgreSQL Authentication**: `.pgpass` file for secure password management
- **SSH Configuration**: Pre-configured `~/.ssh/config` entries for remote servers
- **SSH Key Authentication**: Passwordless SSH access to remote hosts
- **Operating System**: 
  - macOS (primary development platform)
  - Linux (Ubuntu/Debian for remote servers)
  - Windows (planned support)

## üìñ Documentation

- [Design Document](docs/design/PostgreSQL%20Manager%20Design.md) - Technical architecture and specifications
- [Development Milestones](docs/design/PostgreSQL%20Manager%20Milestones.md) - Detailed development roadmap

## üß™ Testing

The project maintains comprehensive test coverage:

```bash
# Run all tests
pytest

# Run with coverage
pytest --cov=src/pgsqlmgr

# Run specific test modules
pytest tests/test_listing.py -v
pytest tests/test_config.py -v
```

**Current Test Stats**: 127 tests passing, 19 skipped (integration tests)

## ü§ù Contributing

We welcome contributions! This project follows modern Python development practices:

### Development Setup
1. Fork the repository
2. Create a virtual environment: `python -m venv .venv`
3. Activate it: `source .venv/bin/activate`
4. Install in development mode: `pip install -e .`
5. Install development dependencies: `pip install -e ".[dev]"`
6. Run tests: `pytest`

### Code Standards
- **Formatting**: We use `black` and `ruff`
- **Type Checking**: `mypy` for type safety
- **Testing**: `pytest` with comprehensive coverage
- **Documentation**: Keep docs updated with changes

### Project Structure
```
pgsql-manager/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ pgsqlmgr/           # Main package
‚îÇ       ‚îú‚îÄ‚îÄ config.py       # Configuration management with inheritance
‚îÇ       ‚îú‚îÄ‚îÄ listing.py      # Database listing functionality
‚îÇ       ‚îú‚îÄ‚îÄ main.py         # CLI interface
‚îÇ       ‚îú‚îÄ‚îÄ db.py          # Database operations
‚îÇ       ‚îú‚îÄ‚îÄ sync.py        # Database synchronization
‚îÇ       ‚îî‚îÄ‚îÄ ssh.py         # SSH operations
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ setup-pgpass.sh     # Helper script to create .pgpass file
‚îú‚îÄ‚îÄ tests/                  # Comprehensive test suite
‚îú‚îÄ‚îÄ docs/                   # Documentation
‚îú‚îÄ‚îÄ .pgpass                 # Symlink to ~/.pgpass for development convenience
‚îú‚îÄ‚îÄ .pgpass.example         # Example .pgpass file with comprehensive examples
‚îú‚îÄ‚îÄ pyproject.toml          # Modern Python packaging
‚îî‚îÄ‚îÄ README.md               # This file
```

## üéØ Core Principles

- **Simplicity**: Easy to install, configure, and use
- **Safety**: Confirmation prompts for destructive operations
- **Modern**: Following 2025 Python packaging best practices
- **Reliable**: Comprehensive testing and error handling
- **Beautiful**: Rich CLI interface with colored output
- **Type-Safe**: Full type hints and enum-based configuration
- **Open**: MIT licensed and open-source

## üìù License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## üôã‚Äç‚ôÇÔ∏è Support

- **Issues**: [GitHub Issues](https://github.com/docchang/pgsqlmgr/issues)
- **Discussions**: [GitHub Discussions](https://github.com/docchang/pgsqlmgr/discussions)

---

**Note**: This project is actively under development with core features implemented and tested. The listing functionality is complete and ready for use. See our [milestones](docs/design/PostgreSQL%20Manager%20Milestones.md) for upcoming features. 